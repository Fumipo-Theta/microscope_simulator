# 薄片写真データの準備方法

1. 薄片写真の撮影
2. メタデータの作成とパッケージ化
3. 画像データの変換

## 薄片写真の撮影

### 前提

- 撮影時の視野の回転中心は、光軸と一致する必要はないが固定されている
- 連続する画像間の回転角は一定である
- オープンニコル、クロスニコルそれぞれ画像枚数は(360の約数)+1である
  - パッケージ作成ツールの都合による。例えば回転角0°～180°まで15°刻みで撮影したとき、原理的には0°～165°までの12枚だけでいいが、現状180°の写真も必要。

### 撮影方法

多色性の様子は2回対称、消光の様子は4回対称である。
したがって、薄片写真としては180°分の画像があれば十分で、多色性がなければ90°分でも十分である。
画像枚数はパッケージのデータサイズ、ネットワーク負荷、アプリ操作時の応答速度とのトレードオフなのでユースケースに合わせて決定する。

## メタデータの作成とパッケージ化

薄片画像データパッケージ作成ツール [TODO: Link me](https://nothing.example.com) を使用する。
このツールはパッケージのメタデータ作成と、薄片写真の回転中心の調整を担う。
なおメタデータの更新を行う場合、このツールで新規にパッケージ作成して古いパッケージと置き換えるか、メタデータを直接編集する必要がある。

### 前提

- マウス/トラックパッドなど、左クリック・右クリックが可能な入力機器の使用
- Google Chromeなどwebp形式のイメージフォーマットをサポートしたwebブラウザの使用
  - Safariは未対応

### 必須項目の入力

- Package ID
  - 重複すると `rock_list.json` のパースに失敗する
- Each rotation degrees
  - 連続する画像間の回転角 [°]
- 回転方向
  - 連続する画像間の回転方向

### 画像選択

必須項目を入力すると、薄片画像を選択できるようになる。
オープンニコル、クロスニコルそれぞれ別セットとして画像を選択する。
このときパッケージ内の画像は選択順に格納されるので、視野を連続的に回転させながら撮影した場合は最初に撮影したものから順に選択するよう注意する。

画像を選択した段階で、ページ下部にプレビュー画面が表示される。

### 追加の情報を入力

- Unit of scale
  - サンプル画像の初期表示でのスケール長 [mm]
- Scale length
  - Unit of scaleに相当するピクセル数
- Magnification of the view
  - 現状未使用
- Sample location
  - サンプル説明で表示
- Owner of the sample
  - サンプル説明で表示
- サンプルタイトル/Sample title
  - サンプル選択リストの表示名として使用
- 岩石名・鉱物名/Rock name or mineral name
  - 現状サンプル説明で表示するのみだが、サンプルの絞り込みに使用する可能性があるため統一的なルールを用意しておくことが望ましい
- サンプルの説明/Description for the sample
  - サンプル説明の本文

### 回転中心の調整

[#画像選択](#画像選択) で選択した画像のプレビューを元に、ビューワーと画像の回転中心を一致させる。

1. 画像上の回転中心の位置を大まかに入力する
   - Rotation center from left (px)
   - Rotation center from top (px)
2. 画像上で右クリックした座標に画像の回転中心が移動する。

### パッケージの作成

`Create package` ボタンを押すと、画像と `manifest.json` からなるzipファイルが生成される。
また、`rock_list.json` の `"list_of_sample"` フィールドの配列に追加するjson文字列も生成される。

## 画像データの変換

必要であれば、画像変換ツール([python script (準備中)](../../cli/make_package.md))を使用し、画像フォーマットを変換したり、ファイルサイズを縮小したりする。
